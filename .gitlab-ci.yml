# =============================================================================
# Meta-MLOps Pipeline - Project Generator
# =============================================================================
# This pipeline is ONLY for generating new MLOps projects.
# The generated projects will have their own full CI/CD pipelines.
# =============================================================================

variables:
  PROJECT_NAME:
    value: "new-mlops-project"
    description: "Name of the new project (no spaces)"
  TASK_TYPE:
    value: "supervised"
    options:
    - "supervised"
    - "unsupervised"
    description: "Machine learning task type"
  DATA_TYPE:
    value: "tabular"
    options:
    - "tabular"
    - "image"
    - "database"
    description: "Primary data type"
  DEPLOYMENT:
    value: "all"
    options:
    - "all"
    - "ray-serve"
    - "ray-batch"
    - "none"
    description: "Deployment target infrastructure"

stages:
- generate

generate_repo:
  stage: generate
  image: python:3.11-slim
  before_script:
    - pip install jinja2
  script:
    - echo "üèóÔ∏è Generating new MLOps project..."
    - mkdir -p generated_projects
    - python scripts/scaffold_project.py --name ${PROJECT_NAME} --task-type ${TASK_TYPE} --data-type ${DATA_TYPE} --deployment ${DEPLOYMENT} --output-dir generated_projects
    - cd generated_projects
    - tar -czf ${PROJECT_NAME}.tar.gz ${PROJECT_NAME}
    - |
      echo "‚úÖ Project generated: ${PROJECT_NAME}.tar.gz"
  artifacts:
    paths:
      - generated_projects/*.tar.gz
    expire_in: 1 week
  when: manual
